version: '3'

services:
  ethereum:
    build:
      context: .
      dockerfile: ./ethereum/Dockerfile
    ports:
      - "8545:8545"

  contract_deployer:
    build:
      context: ./solidity
      dockerfile: ./Dockerfile
    depends_on:
      - ethereum
      - peggy_0

  peggy_0:
    build:
      context: ./module
      dockerfile: ./Dockerfile
    volumes:
      - ./testdata/testchain/peggy_0:/root/home
    depends_on:
      - ethereum
    ports:
      - "26656:26656"
      - "26657:26657"
      - "1317:1317"
      - "9090:9090"

  orchestrator_0:
    build:
      context: ./orchestrator
      dockerfile: ./Dockerfile
    depends_on:
      - ethereum
      - peggy_0

  peggy_1:
    build:
      context: ./module
      dockerfile: ./Dockerfile
    volumes:
      - ./testdata/testchain/peggy_1:/root/home
    depends_on:
      - ethereum
      - peggy_0

  orchestrator_1:
    build:
      context: ./orchestrator
      dockerfile: ./Dockerfile
    depends_on:
      - ethereum
      - peggy_1

  peggy_2:
    build:
      context: ./module
      dockerfile: ./Dockerfile
    volumes:
      - ./testdata/testchain/peggy_2:/root/home
    depends_on:
      - ethereum
      - peggy_0

  orchestrator_2:
    build:
      context: ./orchestrator
      dockerfile: ./Dockerfile
    depends_on:
      - ethereum
      - peggy_2

  peggy_3:
    build:
      context: ./module
      dockerfile: ./Dockerfile
    volumes:
      - ./testdata/testchain/peggy_3:/root/home
    depends_on:
      - ethereum
      - peggy_0

  orchestrator_3:
    build:
      context: ./orchestrator
      dockerfile: ./Dockerfile
    depends_on:
      - ethereum
      - peggy_3